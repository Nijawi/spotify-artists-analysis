---
title: "Top Spotify Tracks of 2017"
author: "James Le"
date: 'Updated: `r Sys.Date()`'
output:
  html_document:
    df_print: paged
    toc: yes
  html_notebook:
    code_folding: hide
    fig_caption: yes
    fig_height: 4.5
    fig_width: 7
    number_sections: yes
    toc: yes
---

# Introduction

In this notebook, I'll take a look at the audio features of the tracks in **Spotify's Top Songs of 2017** playlist and try to highlight the common patterns behind the audio features of these songs. Specifically, I will find out what are the secret ingradients (Tempo, Keys, Names) to make a song popular.

# Data Preparation

First off, letâ€™s import the data and get an idea of what I'm working with.

```{r read, echo=TRUE, message=FALSE, warning=FALSE}
library(readr)
library(plyr)
library(dplyr)
library(ggplot2)
library(tidyverse)
library(reshape)

audio_features <- read.csv('Spotify-Audio-Features.csv')
```

Let's take a look at the summary of this dataset.

```{r summary, echo=TRUE}
head(audio_features)
```

I will rescale some variables, such as `danceability`, `energy`, `speechiness`, `liveness`, `valence` and `accoustiness` for visualization purpose.

* Danceability describes how suitable a track is for dancing,0.0 is least danceable and 1.0 is most danceable.
* Energy is a measure from 0.0 to 1.0 and represents a perceptual measure of intensity and activity.
* Speechiness detects the presence of spoken words in a track. Values above 0.66 describe tracks that are probably made entirely of spoken words. 
* Acousticness :A confidence measure from 0.0 to 1.0 of whether the track is acoustic
* Liveness: Higher liveness values represent an increased probability that the track was performed live.
* Valence: A measure from 0.0 to 1.0 describing the musical positiveness conveyed by a track. Tracks with high valence sound more positive (e.g. happy, cheerful, euphoric).

```{r}
audio_features$danceability<- audio_features$danceability*100
audio_features$energy<- audio_features$energy*100
audio_features$speechiness<- audio_features$speechiness*100
audio_features$acousticness<- audio_features$acousticness*100
audio_features$instrumentalness<- audio_features$instrumentalness*100
audio_features$liveness<- audio_features$liveness*100
audio_features$valence<- audio_features$valence*100
```

For the simplicity, I'll convert `duration_ms` variable in seconds rather than miliseconds.

```{r, echo=TRUE, message=FALSE}
audio_features$duration_ms <- round(audio_features$duration_ms / 1000)
colnames(audio_features)[15] <- "duration"
```

# Data Analysis

## Artists dominating the Top List

Let's determine the artists who have more than one song on the Top 100 Songs List.

```{r, echo=TRUE, message=FALSE}
top_artists <- audio_features %>%
    group_by(artists)  %>%
    summarise(number_apperance = n()) %>%
    filter(number_apperance > 1) %>%
    arrange(desc(number_apperance))

top_artists$artists <- factor(top_artists$artists, levels = top_artists$artists[order(top_artists$number_apperance)]) # visualise the list in descending order 

ggplot(top_artists, aes(x = artists, y = number_apperance)) +
    geom_bar(stat = "identity",  fill = "tomato2", width = 0.6 ) + 
    labs(title = "2017 Top Spotify Artists", x = "Artists", y = "Number of Apperances on the Top 100") +
    theme(plot.title = element_text(size = 15, hjust = -.3, face = "bold"), axis.title = element_text(size = 12)) +
    geom_text(aes(label=number_apperance), hjust = 2, size = 3, color = 'white') +
    coord_flip()
```

So, It seems like **Ed Sheeran** and **The Chainsmokers** rocked the 2017 with 4 different songs on the Top list, while **Drake**  and **Martin Garrix** are following them with 3 different songs.

## Most Popular Songs

Next, let's look at the Top 5 songs. I can see that they all demonstrated high level of danceability, valence, energy. In general, people like happy, positive and enviograted feelings.

```{r}
# Top 5 Songs
m5 <- audio_features[c(1:5),]
m5<- m5[, c(2,4,5,9,10,12,13)] 
m5<- as.data.frame(m5)
m5.long <- melt(m5, id.vars="name")

ggplot(data = m5.long, aes(x = variable, y = value)) + 
  geom_bar(aes(y = value, fill = name), stat = "identity", alpha = 0.8 , position = "dodge") + 
  ylab("Value") + xlab("Song Features") + 
  coord_flip() + ggtitle("Top 5 songs in Spotify 2017 ")
```


## Correlation between variables

In order to understand the correlation between variables, I'll use `corrplot` function, which is one of the base data visualization functions.

```{r , echo=TRUE, message=FALSE}
library(corrplot)
audio_features_num <- audio_features[,-(1:3)]
mtCor <- cor(audio_features_num)
corrplot(mtCor, method = "ellipse", type = "upper", tl.srt = 45)
```

* It seems like `energy` and `loudness` are highly positively correlated.
* Also, `valence` is positively correlated with `danceability` and `energy`. Considering happy songs make people energetic and want to dance, the correlation make a lot sense. 
* Interestingly, `speechiness` and `loudness` are negatively correlated with each other. 
